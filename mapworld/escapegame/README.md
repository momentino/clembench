# EscapeGame

---

`EscapeGame` is a multi-player game with two players - `Guide` and `Seeker`, with the Seeker inside the MapWorld environment (Refer Engine) and the Guide outside the environment. The task for them is to collaborate with each other via a text channel and help the Seeker reach an `Escape Room`. 

The Guide is provided with the image of the escape room, and the game starts with the Guide generating a description of the escape room. This description is passed to the Seeker. Along with this, the Seeker is provided with an image of the current room it is in. With the description of the escape room and the image of the current room, the Seeker can respond with one of the following:

- `MOVE: <direction>` - If the Seeker believes that the description of the escape room does not match with the image it is given
- `QUESTION: <question>` - If the Seeker believes that the description somewhat matches with its current image and it needs more information to verify.
- `ESCAPE` - If the Seeker believes that the description matches exactly with the image of its current room

The Seeker acts as a proactive agent -  it can interact with the environment, ask questions or decide to escape. The Guide, on the other hand, acts as a reactive agent here, only responding with `ANSWER: <answer>` whenever the Seeker asks a `QUESTION`. The Guide cannot interact with the environment or initiate a dialog with the Seeker.s


# Prompts

---


Initial prompts are under - [resources/initial_prompts](resources/initial_prompts) and Seeker re-prompts are under [resources/re_prompts](resources/re_prompts)

# Instance Generation

---

The current experiments are varied across four different variables - Graph Type, Graph Size, Ambiguity and distance. This version contains 15 sets of experiments defined in [resources/experiment_config.json](resources/experiment_config.json) and can be generated by running: 

```python
# Basic Setup
source prepare_path.sh
python3 mapworld/escapegame/instancegenerator.py
```

Current instances are reproducible, so to change the set of instances, change the SEED value in [instancegenerator.py](instancegenerator.py). The number of instances per experiment set can also be changed there.

When the images are called repeatedly from the server [(ling.uni-potsdam.de/clembench/adk/images)](https://www.ling.uni-potsdam.de/clembench/adk/images/), to avoid timeout issues, cache the images in a local image dir - under [resources/images](resources/images). Run - 

```python
python3 mapworld/escapegame/utils/create_local_instances.py
```

This will also create a new instance file - `instances_local.json` that has the image paths pointed towards the local images instead of towards the server.

To create test instances, that selects one random instance from each set of experiments, run - 

```python
python3 mapworld/escapegame/utils/create_test_instances.py
```
# Run

---
This will run all experiments that have generated instances in [in/instances.json](in/instances.json). 

```python
clem run -g escapegame -m mistral-small-3.1-24b-instruct

clem run -g escapegame -m mock
```

To transcribe the model interactions into transcripts (html and tex):

```python
clem transcribe -g escapegame
```
To score the transcribed instances, run:

```python
clem score -g escapegame
```

This calculates three scores per episode:
- Move Efficiency (ME) : Measures how optimally the agent navigates through the environment.
- Dialogue Efficiency (DE) : Captures how concise and cooperative the communication between agents is.
- Task Success (S) : Indicates whether the agent successfully reached the target (escape) room.

The **Clemscore** combines *Move Efficiency* and *Dialogue Efficiency* using the **harmonic mean**, ensuring that both navigation and communication need to be jointly strong. It is only computed for successful episodes.

If `S = 1`  
→ `Clemscore = 2 * (ME * DE) / (ME + DE)`  

If `S = 0`  
→ `Clemscore = 0`

To create evaluation tables, run the following

```python
clem eval
```